<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>

    <!-- Ensure the handler is registered -->
    <handlers>
      <add name="httpPlatformHandler"
           path="*"
           verb="*"
           modules="httpPlatformHandler"
           resourceType="Unspecified"
           requireAccess="Script" />
    </handlers>

    <!-- HttpPlatform settings -->
    <httpPlatform
        processPath="C:\inetpub\wwwroot\ai-backend\venv\Scripts\python.exe"
        arguments="-m uvicorn main:app --host 127.0.0.1 --port %HTTP_PLATFORM_PORT% --workers 2 --loop asyncio --timeout-keep-alive 75"
        stdoutLogEnabled="true"
        stdoutLogFile=".\logs\uvicorn-stdout.log"
        startupTimeLimit="3600"
        rapidFailsPerMinute="0"
        processesPerApplication="1"
        requestTimeout="00:10:00"
        />

    <!-- Optional: Forward proto/host headers to your app -->
    <httpProtocol>
      <customHeaders>
        <add name="X-Forwarded-Proto" value="{HTTPS}" />
        <add name="X-Forwarded-Host" value="{HTTP_HOST}" />
      </customHeaders>
    </httpProtocol>

  </system.webServer>
</configuration>
